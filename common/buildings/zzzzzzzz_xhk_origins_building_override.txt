building_identity_repository = {
	base_buildtime = @b2_time
	planet_limit = 1
	position_priority = 100
	can_demolish = no
	can_be_disabled = no

	category = research

	building_sets = {
		government
		research
		physics
		society
		engineering
	}

	potential = {
		exists = owner
		owner = {
			has_synthetic_fertility_origin = yes
			NOT = { has_country_flag = synthetic_fertility_no_identity_left_behind }
		}
	}

	destroy_trigger = {
		exists = owner
		owner = {
			has_synthetic_fertility_origin = no
		}
	}

	convert_to = {
		building_research_lab_1
	}

	allow = {
		owner = { 
			has_synthetic_fertility_origin = yes
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b4_minerals
		}
		upkeep = {
			energy = 0.02
			mult = owner.value:identity_repository_scaling_mult
		}
		produces = {
			trigger = {
				exists = owner
				owner = { 
					has_synthetic_fertility_origin = yes
				}
			}
			physics_research = 0.02
			society_research = 0.02
			engineering_research = 0.02
			unity = 0.02
			trade = 0.02
			mult = owner.value:identity_repository_scaling_mult
		}
	}

	triggered_planet_modifier = {
		robotic_pop_bonus_workforce_mult = 0.0001
		mult = owner.value:identity_repository_scaling_mult
	}

	triggered_desc = {
		text = building_identity_repository_tt
	}
}

building_abandoned_gene_clinic = {
	icon = building_ancient_cryo_chamber
	position_priority = 100
	can_demolish = no
	can_build = no

	category = amenity

	building_sets = {
		government
	}

	potential = {
		exists = owner
		owner = { 
			has_synthetic_fertility_origin = yes
		}
	}

	destroy_trigger = {
		exists = owner
		owner = { 
			has_synthetic_fertility_origin = no
		}
	}

	allow = {
		owner = { 
			has_synthetic_fertility_origin = yes
		}
	}

	triggered_desc = {
		text = building_abandoned_gene_clinic_tt
	}
}

building_citadel_uplink = {
    base_buildtime = @b3_time
    planetary_ftl_inhibitor = yes
    position_priority = 100
    can_be_ruined = no
    category = army
    planet_limit = 1

    category = planet_buildings

    building_sets = {
        government
        fortress
    }

    potential = {
        exists = owner
        owner = {
            has_starlit_citadel_origin = yes
        }
    }

    allow = {
        exists = solar_system
        solar_system = {
            custom_tooltip = {
                text = "requires_deep_space_citadel"
                count_ship_in_system = {
                    limit = {
                        is_space_citadel_ship_size = yes
                    }
                    count > 0
                }
            }
        }
    }

    destroy_trigger = {
        exists = owner
        exists = solar_system
        OR = {
            owner = {
                NOT = {
                    has_starlit_citadel_origin = yes
                }
            }
            solar_system = {
                count_ship_in_system = {
                    limit = {
                        is_space_citadel_ship_size = yes
                    }
                    count = 0
                }
            }
        }
    }

    convert_to = {
        building_fortress
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @b3_minerals
        }
        upkeep = {
            energy = @b3_upkeep
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = solar_system
            OR = {
                is_scope_valid = no
                AND = {
                    exists = owner
                    owner = { is_regular_empire = yes }
                }
            }
        }
        job_skywatcher_add = @building_static_jobs
        mult = solar_system.value:skywatcher_dsc_mult
    }

    triggered_planet_modifier = {
        potential = {
            exists = solar_system
            exists = owner
            owner = { is_gestalt = yes }
        }
        job_skywatcher_drone_add = @building_static_jobs
        mult = solar_system.value:skywatcher_dsc_mult
    }

    triggered_desc = {
        trigger = {
            exists = owner
            exists = solar_system
            owner = {
                is_gestalt = no
            }
            NOT = {
                solar_system = {
                    any_ship_in_system = {
                        is_ship_size = starbase_deep_space_citadel_3
                    }
                }
            }
        }
        text = job_skywatcher_add_dsc_tt
    }

    triggered_desc = {
        trigger = {
            exists = owner
            exists = solar_system
            owner = {
                is_gestalt = yes
            }
            NOT = {
                solar_system = {
                    any_ship_in_system = {
                        is_ship_size = starbase_deep_space_citadel_3
                    }
                }
            }
        }
        text = job_skywatcher_drone_add_dsc_tt
    }
}

building_clone_army_clone_vat = {
    icon = building_ancient_relics
    base_buildtime = 90
    position_priority = 100

    empire_limit = {
        base = 5
    }

    category = pop_assembly

    building_sets = {
        origin
    }

    potential = {
        exists = owner
        owner = {
            has_clone_army_origin = yes
            NOR = {
                has_country_flag = clone_army_fertility_unlocked
                giga_has_frameworld_origin = yes
                    #frame will use the district version
            }
        }
    }

    destroy_trigger = {
        exists = owner
        OR = {
            owner = {
                OR = {
                    has_clone_army_origin = no
                    is_synthetic_empire = yes
                    has_country_flag = clone_army_fertility_unlocked
                }
            }
        }
    }

    planet_modifier = {
        clone_soldiers_sustained = @clones_sustained_high
    }

    # Add growth from 0 to 25 depending on 'clone_pops_missing_per_vat'.
    triggered_planet_pop_group_modifier_for_species = {
        potential = {
            has_infertile_clone_soldier_trait = yes
            planet = {
                check_variable = { which = clone_pops_missing_per_vat value > 2200 }
            }
        }
        bonus_pop_growth = 25
    }
    triggered_planet_modifier = {
        potential = {
            check_variable = { which = clone_pops_missing_per_vat value > 2200 }
        }
        fake_pop_growth_mod = 25
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 2200
        LOWER_LIMIT = 2000
        GROWTH = 22
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 2000
        LOWER_LIMIT = 1800
        GROWTH = 20
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 1800
        LOWER_LIMIT = 1600
        GROWTH = 17
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 1600
        LOWER_LIMIT = 1400
        GROWTH = 15
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 1400
        LOWER_LIMIT = 1200
        GROWTH = 12
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 1200
        LOWER_LIMIT = 1000
        GROWTH = 10
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 1000
        LOWER_LIMIT = 800
        GROWTH = 7
    }

    inline_script = {
        script = buildings/clone_army_vat_output
        UPPER_LIMIT = 800
        LOWER_LIMIT = 600
        GROWTH = 5
    }

    triggered_planet_pop_group_modifier_for_species = {
        potential = {
            has_infertile_clone_soldier_trait = yes
            planet = {
                check_variable = { which = clone_pops_missing_per_vat value <= 600 }
            }
        }
        bonus_pop_growth = 2
    }
    triggered_planet_modifier = {
        potential = {
            check_variable = { which = clone_pops_missing_per_vat value <= 600 }
        }
        fake_pop_growth_mod = 2
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_cloning_authority = yes
                is_megacorp = yes
            }
        }
        planet_jobs_trade_produces_mult = @replicatory_association_trade_mult
        planet_amenities_add = @replicatory_association_amenities_add
        mult = 2
    }

    resources = {
        category = planet_buildings_clone_vats
        cost = {
            minerals = @b2_minerals
        }
        upkeep = {
            energy = @b2_upkeep
        }
    }

    upgrades = {
    }

    prerequisites = {
    }

    triggered_desc = {
        text = building_clone_army_clone_vat_effect_desc
    }

    is_essential = yes
    ai_estimate_without_unemployment = yes
}